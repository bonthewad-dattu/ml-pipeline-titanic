<!DOCTYPE html>
<html lang=\"en\">
<head>
    <meta charset=\"UTF-8\">
    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
    <title>Titanic Survival Predictor</title>
    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">
</head>
<body>
    <nav class=\"navbar navbar-dark bg-dark\">
        <div class=\"container\">
            <span class=\"navbar-brand\">🚀 ML Pipeline - Titanic Predictor</span>
        </div>
    </nav>

    <div class=\"container mt-5\">
        <div class=\"row\">
            <div class=\"col-md-8\">
                <div class=\"card\">
                    <div class=\"card-header bg-primary text-white\">
                        <h4>Survival Prediction Form</h4>
                    </div>
                    <div class=\"card-body\">
                        <form id=\"predictionForm\">
                            <div class=\"row\">
                                <div class=\"col-md-6\">
                                    <div class=\"mb-3\">
                                        <label class=\"form-label\">Passenger Class</label>
                                        <select class=\"form-select\" name=\"Pclass\" required>
                                            <option value=\"\">Select Class</option>
                                            <option value=\"1\">1st Class</option>
                                            <option value=\"2\">2nd Class</option>
                                            <option value=\"3\">3rd Class</option>
                                        </select>
                                    </div>
                                    
                                    <div class=\"mb-3\">
                                        <label class=\"form-label\">Gender</label>
                                        <select class=\"form-select\" name=\"Sex\" required>
                                            <option value=\"\">Select Gender</option>
                                            <option value=\"male\">Male</option>
                                            <option value=\"female\">Female</option>
                                        </select>
                                    </div>
                                    
                                    <div class=\"mb-3\">
                                        <label class=\"form-label\">Age</label>
                                        <input type=\"number\" class=\"form-control\" name=\"Age\" min=\"0\" max=\"100\" required>
                                    </div>
                                </div>
                                
                                <div class=\"col-md-6\">
                                    <div class=\"mb-3\">
                                        <label class=\"form-label\">Siblings/Spouses</label>
                                        <input type=\"number\" class=\"form-control\" name=\"SibSp\" min=\"0\" max=\"10\" value=\"0\" required>
                                    </div>
                                    
                                    <div class=\"mb-3\">
                                        <label class=\"form-label\">Parents/Children</label>
                                        <input type=\"number\" class=\"form-control\" name=\"Parch\" min=\"0\" max=\"10\" value=\"0\" required>
                                    </div>
                                    
                                    <div class=\"mb-3\">
                                        <label class=\"form-label\">Fare (£)</label>
                                        <input type=\"number\" class=\"form-control\" name=\"Fare\" min=\"0\" max=\"500\" step=\"0.1\" required>
                                    </div>
                                    
                                    <div class=\"mb-3\">
                                        <label class=\"form-label\">Embarkation Port</label>
                                        <select class=\"form-select\" name=\"Embarked\" required>
                                            <option value=\"\">Select Port</option>
                                            <option value=\"C\">Cherbourg</option>
                                            <option value=\"Q\">Queenstown</option>
                                            <option value=\"S\">Southampton</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <button type=\"submit\" class=\"btn btn-primary btn-lg w-100\">
                                Predict Survival
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class=\"col-md-4\">
                <div class=\"card\" id=\"resultCard\" style=\"display: none;\">
                    <div class=\"card-header\" id=\"resultHeader\">
                        <h4>Prediction Result</h4>
                    </div>
                    <div class=\"card-body text-center\">
                        <div id=\"resultContent\"></div>
                    </div>
                </div>
                
                <div class=\"card mt-3\">
                    <div class=\"card-header bg-info text-white\">
                        <h5>Model Information</h5>
                    </div>
                    <div class=\"card-body\">
                        <div id=\"modelInfo\">
                            <div class=\"spinner-border\" role=\"status\">
                                <span class=\"visually-hidden\">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\"></script>
    <script>
        // Load model information
        async function loadModelInfo() {
            try {
                const response = await fetch('/model_info');
                const data = await response.json();
                
                const modelInfoDiv = document.getElementById('modelInfo');
                modelInfoDiv.innerHTML = 
                    <p><strong>Model Type:</strong> </p>
                    <p><strong>Features:</strong> </p>
                    <p><strong>Status:</strong> </p>
                ;
            } catch (error) {
                document.getElementById('modelInfo').innerHTML = '<p class=\"text-danger\">Unable to load model information</p>';
            }
        }

        // Handle form submission
        document.getElementById('predictionForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const inputData = Object.fromEntries(formData.entries());
            
            // Convert numeric fields
            inputData.Pclass = parseInt(inputData.Pclass);
            inputData.Age = parseFloat(inputData.Age);
            inputData.SibSp = parseInt(inputData.SibSp);
            inputData.Parch = parseInt(inputData.Parch);
            inputData.Fare = parseFloat(inputData.Fare);
            
            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(inputData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    displayPredictionResult(result, inputData);
                } else {
                    alert('Prediction failed: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                alert('Network error: Unable to connect to prediction service');
            }
        });

        // Display prediction result
        function displayPredictionResult(result, inputData) {
            const resultCard = document.getElementById('resultCard');
            const resultContent = document.getElementById('resultContent');
            const resultHeader = document.getElementById('resultHeader');
            
            // Set card styling based on prediction
            if (result.prediction === 1) {
                resultCard.className = 'card border-success';
                resultHeader.className = 'card-header bg-success text-white';
                resultHeader.innerHTML = '<h4>✅ Survival Predicted!</h4>';
            } else {
                resultCard.className = 'card border-danger';
                resultHeader.className = 'card-header bg-danger text-white';
                resultHeader.innerHTML = '<h4>❌ Did Not Survive</h4>';
            }
            
            // Create result content
            resultContent.innerHTML = 
                <div class=\"prediction-result\">
                    <div class=\"mb-3\">
                        <h2 class=\"\"></h2>
                    </div>
                    
                    <div class=\"mb-3\">
                        <h5>Confidence: </h5>
                        <div class=\"progress\">
                            <div class=\"progress-bar \" 
                                 style=\"width: \">
                                
                            </div>
                        </div>
                    </div>
                    
                    <div class=\"model-info\">
                        <p><strong>Model:</strong> </p>
                        <p><strong>Probability:</strong> %</p>
                    </div>
                </div>
            ;
            
            // Show the result card
            resultCard.style.display = 'block';
        }

        // Load model info when page loads
        document.addEventListener('DOMContentLoaded', loadModelInfo);
    </script>
</body>
</html>
